@model FitnessCenter.Models.AiModel

@{
    ViewData["Title"] = "AI Body Architect";
}

<!-- (نفس الـCSS تبعك تمامًا) -->
<style>
    html, body { height: 100%; margin: 0; }
    body { background: transparent !important; position: relative; min-height: 100vh; }
    body::before {
        content: ""; position: fixed; inset: 0; z-index: -1;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364) !important;
    }
    main, .container, .container-fluid, .bg-light, .content, .content-wrapper, .page-content, .wrapper, #wrapper {
        background: transparent !important;
    }
    .compare-card { border: 0; border-radius: 16px; overflow: hidden; box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
    .compare-header { font-weight: 800; letter-spacing: .2px; }
    .img-limit { max-height: 520px; width: auto; object-fit: contain; }
</style>

<div class="container mt-5">
    <div class="row">

        <!-- LEFT FORM -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fa fa-robot"></i> AI Antrenör</h4>
                </div>
                <div class="card-body">
                    <form asp-action="Index" method="post" enctype="multipart/form-data">

                        <div class="mb-3">
                            <label>Yaş</label>
                            <input asp-for="Age" class="form-control" type="number" required />
                            <span asp-validation-for="Age" class="text-danger small"></span>
                        </div>

                        <div class="mb-3">
                            <label>Kilo (kg)</label>
                            <input asp-for="Weight" class="form-control" type="number" required />
                            <span asp-validation-for="Weight" class="text-danger small"></span>
                        </div>

                        <div class="mb-3">
                            <label>Boy (cm)</label>
                            <input asp-for="Height" class="form-control" type="number" required />
                            <span asp-validation-for="Height" class="text-danger small"></span>
                        </div>

                        <div class="mb-3">
                            <label>Cinsiyet</label>
                            <select asp-for="Gender" class="form-select">
                                <option value="Erkek">Erkek</option>
                                <option value="Kadın">Kadın</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label>Spor Hedefiniz</label>
                            <input asp-for="Goal" class="form-control" placeholder="Örn: Kilo vermek, kas yapmak..." required />
                            <span asp-validation-for="Goal" class="text-danger small"></span>
                        </div>

                        <div class="mb-3">
                            <label>Plan Süresi (Ay)</label>
                            <input asp-for="DurationMonths" class="form-control" type="number" min="1" max="24" />
                            <small class="text-muted">Örn: 6 ay</small>
                            <span asp-validation-for="DurationMonths" class="text-danger small"></span>
                        </div>

                        <div class="mb-3">
                            <label class="fw-bold">Fotoğraf (Opsiyonel)</label>
                            <input asp-for="Photo" type="file" class="form-control" accept="image/*" />

                            <small class="text-muted d-block mt-1">
                                ℹ️ Fotoğraf yüklerseniz <b>Before / After</b> vücut dönüşüm simülasyonu oluşturulur.
                            </small>

                            <small class="text-warning d-block mt-1">
                                ⚠️ <b>Önemli:</b> Lütfen <u>tişört ve spor kıyafeti</u> ile çekilmiş bir fotoğraf yükleyin.<br />
                                Çıplak üst vücut, mayo veya iç çamaşırı içeren fotoğraflar desteklenmez.
                            </small>
                        </div>


                        <div class="mb-3">
                            <label>Ek bilgi yazınız</label>
                            <textarea asp-for="ExtraNote" class="form-control" rows="3"
                                      placeholder="Örn: Haftada 3 gün spor yapabilirim, dizimde ağrı var, ekipman yok..."></textarea>
                        </div>

                        <button type="submit" class="btn btn-success w-100">Planı Al</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- RIGHT RESULT -->
        <div class="col-md-8">

            @* Case (2): photo uploaded but after failed *@
            @if (!string.IsNullOrWhiteSpace(Model.ImageError))
            {
                <div class="alert alert-danger shadow-sm rounded-4 p-4">
                    <b>After Görseli Üretilemedi:</b> @Model.ImageError
                </div>
            }

            @* Case (2): show before/after if both exist *@
            @if (!string.IsNullOrEmpty(Model.UploadedImageUrl) && !string.IsNullOrEmpty(Model.GeneratedImageUrl))
            {
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <div class="card compare-card">
                            <div class="card-header text-center text-white compare-header"
                                 style="background: linear-gradient(135deg, #111111, #2b2b2b);">
                                BEFORE (Yüklenen Fotoğraf)
                            </div>
                            <div class="card-body bg-white text-center p-4">
                                <img src="@Model.UploadedImageUrl" class="img-fluid rounded shadow img-limit" />
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card compare-card">
                            <div class="card-header text-center text-white compare-header"
                                 style="background: linear-gradient(135deg, #6a11cb, #2575fc);">
                                AFTER (AI Tahmini)
                            </div>
                            <div class="card-body bg-white text-center p-4">
                                <img src="@Model.GeneratedImageUrl" class="img-fluid rounded shadow img-limit" />
                                <p class="text-muted mt-3 mb-0 small fst-italic">
                                    Bu görüntü, hedefinize @Model.DurationMonths ayda ulaşmanız durumunda olası görünüm simülasyonudur.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            }

            @* Always show plan if exists (Case 1 & 2) *@
            @if (!string.IsNullOrEmpty(Model.AiResponse))
            {
                <div class="card shadow border-success mb-5">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Önerilen Planınız</h4>
                    </div>
                    <div class="card-body bg-light text-dark">
                        <div style="white-space: pre-line; font-size: 1.05em; line-height: 1.7;">
                            @Model.AiResponse
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="alert alert-info shadow-sm rounded-4 p-4 text-center">
                    <i class="fas fa-robot fa-3x mb-3 text-primary"></i>
                    <h4 class="alert-heading fw-bold">AI Body Architect'e Hoş Geldiniz!</h4>
                    <p class="mb-0 fs-5">
                        Formu doldurun. Fotoğraf yüklerseniz Before/After simülasyonu da üretilecektir.
                    </p>
                </div>
            }
        </div>

    </div>
</div>
